Jenkins과 Maven을 사용하여 CI 적용하기

다른 개발자와 스마트스토어 프로젝트를 통해서 협업을 하면서 
각자 개발한 부분이 충돌이나 오류없이 잘 구동이 되는지 확인하려면 해당 branch를 local로 clone하고 build하고 테스트를 해봐야 했다. 
이것은 매우 번거로운 작업이며 개발자의 생산성을 매우 저해하는 패턴이라고 느껴졌다. 
개발자가 개발에만 집중하기 위해서. 
작은 변경사항이 생기더라도 다시 빌드 - 전송 - 실행을 반복해야 한다. 
통합 테스트를 하기 위해서는 어플리케이션을 구동하여 여러 요청을 날려보고 확인해야 했다. 

Jenkins는 위와 같은 반복적인 작업을 더 간편하게 해결할 수 있는 툴이다. 
Github와도 상호작용할 수 있다는 강점이 있다. 
webhook이란 ?
웹훅은 다양한 콘텐츠 유형을 사용하여 제공 될 수 있습니다. 
애플리케이션 / json 콘텐츠 유형은 POST 요청의 body로 JSON 페이로드를 직접 제공합니다. 
application / x-www-form-urlencoded 콘텐츠 유형은 JSON 페이로드를 payload라는 양식 parameter로 보냅니다.

Git : push ->  Github : webhook 전송 -> jenkins parameter parsing 및 branch 정보 확인 clean package 작업

Jenkins를 사용하겠다는 원대한 계획이 있었지만, 일단 Jenkins를 돌릴 서버가 필요했다. 
jenkins CI에 대한 여러 블로그 글들을 읽던 와중에 https://jojoldu.tistory.com/139글을 참고하여 일단 로컬에서 Jenkins서버를 사용하는 방법을 선택했다. 
Jenkins서버를 로컬 환경에서 Github와 연동하기 위해서는 localhost가 아닌 url이 필요한데 ngrok이라는 툴은 이것을 가능하게 해준다. 설치와 사용법도 어렵지 않아서 금방 적용할 수 있었다. 

연계를 구현하는 것이 1차적 목표였기 때문에, 아주 간단한 hello world를 출력하는 Java Project를 생성하여 git에 push하여 테스트하기로 했다. 
다만 이 프로젝트는 maven을 사용하지 않았기 때문에 echo 명령어로 간단한 문구를 출력되도록만 설정했다.

1차적 목적을 달성하여 연계가 잘 되는 것을 확인했고, 이제 그 다음 목표로 실제 상용 클라우드 서버에서 현재 진행중인 project에 적용해보기로 했다. 
처음 사용해보는 기술이지만 언젠가 실전에서도 익숙하게 사용하기 위해서는 최대한 비슷한 환경을 구성하여 사용해보는 것이 좋다고 생각했다. 
과거 개인 프로젝트에서 사용했던 AWS의 EC2를 다시 사용해볼까 했지만, 그 당시에 서버를 운영하면서 예상보다 많았던 지출이 있었던 기억이 있다.
게다가 현재 개발중인 스마트스토어 프로젝트는 CI/CD서버, WAS서버, DB서버(replication한다면 master-slave로 나뉘어 2개의 DB서버가 필요하게 된다.)가 필요하기 때문에 
무작정 과금을 하며 ec2를 사용하자니 청구될 금액이 걱정이었다. 

클라우드 서버를 알아보던 중 NCP(네이버 클라우드 플랫폼)의 경우 신규가입자에게 10만 크레딧(10만원 상당)을 제공한다는 사실을 알게 되었다. 
물론 10만 크레딧으로 24시간 풀로 몇날며칠 운영하는 것은 힘들 수 있겠지만, 기본적인 아키텍트를 구성하고 테스트하기에는 충분하다고 생각되었다. 

NCP에서 Jenkins CI용 서버를 생성하고 os는 ubuntu16.04를 설치한 후 Jenkins와 java, maven을 설치하였다. 

Jenkins를 통한 CI를 구현
일반적으로 Jenkins를 통해 CI(Continuous Integration)인 테스트와 빌드를 진행하고 docker를 사용하여 CD(Continuous Deployment)를 진행한다.
나는 이번이 CI/CD를 처음 경험하는 것이기 때문에, CI와 CD를 동시에 구현하기에는 많은 정보들이 머릿 속에 정리가 되지 않을 것 같아서 
먼저 CI를 먼저 구현한 후, CD를 해보기로 했다. 이번 글은 CI에 대한 글이며 CD는 다음 글에서 정리해 보겠다. 


혼자 진행하는 프로젝트가 아니라 협업하는 프로젝트이기 때문에 처음 해보는 연계 테스트에 예상치 못한 사고를 칠까봐(네. 제가 겁이 많습니다..)
해당 repository에 바로 적용하지 않고, fork한 후에 동일한 소스로 진행했다. 
